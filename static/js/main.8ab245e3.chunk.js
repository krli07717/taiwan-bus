(this.webpackJsonpf2e_3=this.webpackJsonpf2e_3||[]).push([[0],[,,,,,,,,,,,,,,,,,function(t,e,n){},function(t,e,n){},function(t,e,n){},,,function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){"use strict";n.r(e);var a=n(1),c=n.n(a),s=n(11),i=n.n(s),r=n(4),o=(n(17),n(3)),u=(n(18),n.p+"static/media/icon-location.e4f566a1.svg"),l=n.p+"static/media/icon-search.f23fbc2c.svg",j=(n(19),n.p+"static/media/logo.34be31bd.svg"),b=n.p+"static/media/logo-zh.cba7fb6c.svg",h=n(0);function d(){return Object(h.jsx)("h1",{className:"logo",children:Object(h.jsx)(r.b,{to:"/taiwan-bus/",children:Object(h.jsx)("img",{src:b,alt:"Taiwan Bus Logo"})})})}function p(){return Object(h.jsx)("h1",{className:"logo",children:Object(h.jsx)(r.b,{to:"/taiwan-bus/",children:Object(h.jsx)("img",{src:j,alt:"Taiwan Bus Logo"})})})}function m(){return Object(h.jsxs)("nav",{children:[Object(h.jsxs)(r.b,{to:"/taiwan-bus/nearby-bus",className:"button_heavy",children:[Object(h.jsx)("img",{src:u,alt:"location icon"}),"\u9644\u8fd1\u516c\u8eca\u7ad9"]}),Object(h.jsxs)(r.b,{to:"/taiwan-bus/search-bus",className:"button_heavy",children:[Object(h.jsx)("img",{src:l,alt:"search icon"}),"\u67e5\u8a62\u516c\u8eca"]}),Object(h.jsxs)(r.b,{to:"/taiwan-bus/search-train",className:"button_heavy",children:[Object(h.jsx)("img",{src:l,alt:"search icon"}),"\u67e5\u8a62\u5ba2\u904b"]})]})}function f(){return Object(h.jsxs)("footer",{children:["Taiwan Bus \xa9"," ",Object(h.jsx)("a",{href:"https://github.com/krli07717/taiwan-bus",target:"_blank",rel:"noreferrer",children:"Code"})," ","/ Design: KT"]})}function O(){return Object(h.jsxs)("div",{className:"homepage",children:[Object(h.jsx)(p,{}),Object(h.jsx)(m,{}),Object(h.jsx)(f,{})]})}var x=n(5),y=n.n(x),v=n(7);n(22),n(23);function _(t){var e=t.city_zh,n=t.city_en,a=t.handleChooseCity;return Object(h.jsxs)("label",{htmlFor:n,children:[Object(h.jsx)("input",{type:"radio",name:"city",id:n,"data-city_zh":e,onChange:a,hidden:!0}),Object(h.jsx)("span",{className:"button_heavy",children:e})]})}function N(t){var e=t.handleChooseCity,n=t.handleSubmitCity,a=Object(h.jsxs)("label",{htmlFor:"set_city",children:[Object(h.jsx)("input",{type:"submit",id:"set_city",hidden:!0}),Object(h.jsx)("span",{className:"button_heavy",children:"\u8a2d\u5b9a"})]});return Object(h.jsxs)("form",{className:"city_keyboard",onSubmit:n,children:[[{city_zh:"\u81fa\u5317\u5e02",city_en:"Taipei"},{city_zh:"\u65b0\u5317\u5e02",city_en:"NewTaipei"},{city_zh:"\u6843\u5712\u5e02",city_en:"Taoyuan"},{city_zh:"\u81fa\u4e2d\u5e02",city_en:"Taichung"},{city_zh:"\u81fa\u5357\u5e02",city_en:"Tainan"},{city_zh:"\u9ad8\u96c4\u5e02",city_en:"Kaohsiung"},{city_zh:"\u57fa\u9686\u5e02",city_en:"Keelung"},{city_zh:"\u65b0\u7af9\u5e02",city_en:"Hsinchu"},{city_zh:"\u65b0\u7af9\u7e23",city_en:"HsinchuCounty"},{city_zh:"\u82d7\u6817\u7e23",city_en:"MiaoliCounty"},{city_zh:"\u5f70\u5316\u7e23",city_en:"ChanghuaCounty"},{city_zh:"\u5357\u6295\u7e23",city_en:"NantouCounty"},{city_zh:"\u96f2\u6797\u7e23",city_en:"YunlinCounty"},{city_zh:"\u5609\u7fa9\u7e23",city_en:"ChiayiCounty"},{city_zh:"\u5609\u7fa9\u5e02",city_en:"Chiayi"},{city_zh:"\u5c4f\u6771\u7e23",city_en:"PingtungCounty"},{city_zh:"\u5b9c\u862d\u7e23",city_en:"YilanCounty"},{city_zh:"\u82b1\u84ee\u7e23",city_en:"HualienCounty"},{city_zh:"\u81fa\u6771\u7e23",city_en:"TaitungCounty"},{city_zh:"\u91d1\u9580\u7e23",city_en:"KinmenCounty"},{city_zh:"\u6f8e\u6e56\u7e23",city_en:"PenghuCounty"},{city_zh:"\u9023\u6c5f\u7e23",city_en:"LienchiangCounty"}].map((function(t){var n=t.city_zh,a=t.city_en;return Object(h.jsx)(_,{city_zh:n,city_en:a,handleChooseCity:e},n)})),a]})}n(24);function g(t){var e=t.routeInfo,n=t.city,a=e.RouteUID,c=e.DepartureStopNameZh,s=e.DestinationStopNameZh,i=e.RouteName,o=c&&s?Object(h.jsxs)("p",{className:"route_fromTo",children:[c,Object(h.jsx)("span",{children:"\xa0\xa0\u5f80\xa0\xa0"}),s]}):null;return Object(h.jsxs)(r.b,{to:"/taiwan-bus/".concat(n[0],"/").concat(a),className:"route",children:[Object(h.jsx)("span",{className:"route_name",children:i}),o]})}function S(t){var e=t.city,n=t.routes.map((function(t){return Object(h.jsx)(g,{routeInfo:t,city:e},t.RouteUID)})),a=Object(h.jsx)("span",{className:"no_routes",children:"\u6c92\u6709\u7b26\u5408\u8def\u7dda"});return Object(h.jsxs)("div",{className:"routes",children:[Object(h.jsx)("h2",{className:"routes_city",children:e[1]}),Object(h.jsx)("div",{className:"routes_list",children:n.length?n:a})]})}var w=n(12);function C(){var t=(new Date).toGMTString(),e=new w.a("SHA-1","TEXT");return e.setHMACKey("vjTEyBOiAfZny92QM76fuhDGG9M","TEXT"),e.update("x-date: "+t),{Authorization:'hmac username="cf82a65ff157414d806715c121e642bd", algorithm="hmac-sha1", headers="x-date", signature="'+e.getHMAC("B64")+'"',"X-Date":t}}function I(t){return D.apply(this,arguments)}function D(){return(D=Object(v.a)(y.a.mark((function t(e){var n,a;return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(e,{headers:C()});case 3:return n=t.sent,t.next=6,n.json();case 6:return a=t.sent,t.abrupt("return",a);case 10:throw t.prev=10,t.t0=t.catch(0),t.t0;case 13:case"end":return t.stop()}}),t,null,[[0,10]])})))).apply(this,arguments)}function z(t){var e=t.value,n=t.onChange,a=t.disabled;return Object(h.jsx)("input",{type:"search",value:e,placeholder:"\u8f38\u5165\u8def\u7dda\u95dc\u9375\u5b57",onChange:n,disabled:a})}function R(){var t=Object(a.useState)([]),e=Object(o.a)(t,2),n=e[0],c=e[1],s=Object(a.useState)(""),i=Object(o.a)(s,2),r=i[0],u=i[1],l=Object(a.useState)(!1),j=Object(o.a)(l,2),b=j[0],p=j[1],m=Object(a.useState)([]),f=Object(o.a)(m,2),O=f[0],x=f[1],_=Object(a.useRef)([]);return Object(a.useEffect)((function(){_.current.length>0||n.length&&function(t){e.apply(this,arguments)}("https://ptx.transportdata.tw/MOTC/v2/Bus/Route/City/".concat(n[0],"?$format=JSON"));function t(t){return t.map((function(t){return{RouteUID:t.RouteUID,DepartureStopNameZh:t.DepartureStopNameZh,DestinationStopNameZh:t.DestinationStopNameZh,RouteName:t.RouteName.Zh_tw}}))}function e(){return(e=Object(v.a)(y.a.mark((function e(n){var a,c;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,I(n);case 3:a=e.sent,c=t(a),_.current=c,x(c),e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),e.t0;case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}}),[b]),Object(a.useEffect)((function(){var t=_.current.filter((function(t){return t.RouteName.includes(r)}));x(t)}),[r]),Object(h.jsxs)("div",{className:"search_bus_page",children:[Object(h.jsxs)("div",{className:"top_nav",children:[Object(h.jsx)(d,{}),Object(h.jsx)(z,{value:r,onChange:function(t){u(t.target.value)},disabled:0===_.current.length})]}),0===_.current.length?Object(h.jsx)(N,{handleChooseCity:function(t){c([t.target.id,t.target.dataset.city_zh])},handleSubmitCity:function(t){t.preventDefault(),n.length&&p(!0)}}):Object(h.jsx)(S,{city:n,routes:O})]})}n(25);var U=n(2),T=n.p+"static/media/icon-back.d842da2e.svg";var k=function(){return Object(h.jsx)("img",{src:T,alt:"back icon",className:"back_page",onClick:function(){window.history.go(-1)}})};function L(t){var e=t.stopInfo,n=e.stopName,a=e.plateNumb,c=e.estimatedSeconds,s=e.stopStatus;return Object(h.jsxs)("div",{className:"stop ".concat(function(t){return void 0===t?"off":t<120?"approaching":""}(c)),children:[4===s?Object(h.jsx)("span",{className:"estimated_time off",children:"\u672a\u71df\u904b"}):3===s?Object(h.jsx)("span",{className:"estimated_time off",children:"\u672b\u73ed\u5df2\u904e"}):2===s?Object(h.jsx)("span",{className:"estimated_time off",children:"\u4ea4\u7ba1\u4e0d\u505c"}):1===s||void 0===s?Object(h.jsx)("span",{className:"estimated_time off",children:"\u672a\u767c\u8eca"}):c<120?Object(h.jsx)("span",{className:"estimated_time approaching",children:"\u9032\u7ad9\u4e2d"}):Object(h.jsxs)("span",{className:"estimated_time",children:[Object(h.jsx)("span",{className:"minute",children:Math.floor(c/60)}),"\xa0\u5206"]}),Object(h.jsx)("span",{className:"stop_name",children:n}),Object(h.jsx)("span",{className:"plate_numb",children:a}),Object(h.jsx)("span",{className:"circle",children:Object(h.jsx)("span",{className:"inner"})})]})}function B(t){return t.stopStatus.map((function(t){return Object(h.jsx)(L,{stopInfo:t},t.stopUID)}))}function M(){var t=Object(U.g)(),e=t.city,n=t.RouteUID,c=Object(a.useState)([]),s=Object(o.a)(c,2),i=s[0],r=s[1],u=Object(a.useState)([]),l=Object(o.a)(u,2),j=l[0],b=l[1],p=Object(a.useState)(!1),m=Object(o.a)(p,2),f=m[0],O=m[1],x=Object(a.useState)(0),_=Object(o.a)(x,2),N=_[0],g=_[1];function S(t){!1===f&&"from"===t.target.id&&O(!0),!0===f&&"to"===t.target.id&&O(!1)}Object(a.useEffect)((function(){function t(){return a.apply(this,arguments)}function a(){return a=Object(v.a)(y.a.mark((function t(){var a,c,s,i,u,l,j,h,d,p,m;return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a="https://ptx.transportdata.tw/MOTC/v2/Bus/EstimatedTimeOfArrival/City/".concat(e,"?$filter=RouteUID%20eq%20'").concat(n,"'&$format=JSON"),c="https://ptx.transportdata.tw/MOTC/v2/Bus/StopOfRoute/City/".concat(e,"?$filter=RouteUID%20eq%20'").concat(n,"'&$top=30&$format=JSON"),t.prev=2,d=function(t){var e;return null===(e=j.find((function(e){return e.Direction===t})))||void 0===e?void 0:e.Stops.map((function(e){var n,a=null!==(n=h.find((function(n){var a=n.Direction,c=n.StopUID;return a===t&&c===e.StopUID})))&&void 0!==n?n:{},c=a.PlateNumb,s=a.EstimateTime,i=a.StopStatus;return{stopUID:e.StopUID,stopName:e.StopName.Zh_tw,stopStatus:i,plateNumb:c,estimatedSeconds:s}})).filter((function(t,e,n){return e===n.findIndex((function(e){return t.stopUID===e.stopUID}))}))},t.next=6,Promise.allSettled([I(c),I(a)]);case 6:u=t.sent,l=Object(o.a)(u,2),j=l[0].value,h=l[1].value,p=null!==(s=d(0))&&void 0!==s?s:[],m=null!==(i=d(1))&&void 0!==i?i:[],r(p),b(m),g(0),t.next=20;break;case 17:throw t.prev=17,t.t0=t.catch(2),t.t0;case 20:case"end":return t.stop()}}),t,null,[[2,17]])}))),a.apply(this,arguments)}var c=setInterval(t,6e4);t();var s=setInterval((function(){g((function(t){return++t}))}),1e3);return function(){clearInterval(c),clearInterval(s)}}),[]);var w=i.length?Object(h.jsxs)("span",{className:"direction",children:[Object(h.jsx)("span",{children:"\u5f80\xa0"}),i[i.length-1].stopName]}):Object(h.jsx)("span",{className:"direction no_route",children:"\u6c92\u6709\u53bb\u7a0b"}),C=j.length?Object(h.jsxs)("span",{className:"direction",children:[Object(h.jsx)("span",{children:"\u5f80\xa0"}),j[j.length-1].stopName]}):Object(h.jsx)("span",{className:"direction no_route",children:"\u6c92\u6709\u8fd4\u7a0b"});return Object(h.jsxs)("div",{className:"bus_status_page",children:[Object(h.jsxs)("div",{className:"top_nav",children:[Object(h.jsx)(k,{}),Object(h.jsx)(d,{})]}),Object(h.jsxs)("div",{className:"choose_direction",children:[Object(h.jsxs)("label",{htmlFor:"to",children:[Object(h.jsx)("input",{type:"radio",name:"direction",id:"to",checked:!f,disabled:0===i.length,onChange:S,hidden:!0}),w]}),Object(h.jsxs)("label",{htmlFor:"from",children:[Object(h.jsx)("input",{type:"radio",name:"direction",id:"from",checked:f,disabled:0===j.length,onChange:S,hidden:!0}),C]})]}),Object(h.jsxs)("div",{className:"status_list",children:[Object(h.jsxs)("span",{className:"update_time",children:["*\u65bc\b",N,"\u79d2\u524d\u66f4\u65b0"]}),Object(h.jsx)("div",{className:"stops",children:Object(h.jsx)(B,{stopStatus:f?j:i})})]})]})}n(26);var E=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{enableHighAccuracy:!0,timeout:5e3,maximumAge:0};return new Promise((function(e,n){navigator.geolocation.getCurrentPosition((function(t){e([t.coords.latitude,t.coords.longitude])}),(function(t){n(t)}),t)}))};function Z(t){var e=t.nearbyStationInfo,n=t.userLocation,a=e.nearbyStationName,c=e.possibleRoutes,s=c.map((function(t){return t.routeName})).join(", ");return Object(h.jsxs)(r.b,{to:"/taiwan-bus/".concat(encodeURIComponent(a)),className:"route",state:{possibleRoutes:c,userLocation:n},children:[Object(h.jsx)("span",{className:"route_name",children:a}),s]})}function $(t){var e=t.nearbyStations,n=t.userLocation,a=e.map((function(t){return Object(h.jsx)(Z,{nearbyStationInfo:t,userLocation:n},t.nearbyStationName)}));return Object(h.jsx)("div",{className:"routes",children:Object(h.jsx)("div",{className:"routes_list",children:a.length?a:null})})}function A(t){var e=t.userLocation,n=t.setUserLocation,c=Object(a.useState)([]),s=Object(o.a)(c,2),i=s[0],r=s[1];return Object(a.useEffect)((function(){var t=!1;function a(){return(a=Object(v.a)(y.a.mark((function e(){var a,c,s,i;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,E();case 3:a=e.sent,c=Object(o.a)(a,2),s=c[0],i=c[1],t||n([s,i]),e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(0),e.t0;case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}return e.length||function(){a.apply(this,arguments)}(),function(){return t=!0}}),[]),Object(a.useEffect)((function(){function t(){return(t=Object(v.a)(y.a.mark((function t(){var n,a,c;return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="https://ptx.transportdata.tw/MOTC/v2/Bus/Station/NearBy?$spatialFilter=nearby(".concat(e[0],",").concat(e[1],",500)&$format=JSON"),t.next=4,I(n);case 4:a=t.sent,c=a.map((function(t){var e=t.Stops.map((function(t){return{routeUID:t.RouteUID,routeName:t.RouteName.Zh_tw}}));return{nearbyStationName:t.StationName.Zh_tw,possibleRoutes:e}})).filter((function(t,e,n){return e===n.findIndex((function(e){return t.nearbyStationName===e.nearbyStationName}))})),r(c),t.next=12;break;case 9:throw t.prev=9,t.t0=t.catch(0),t.t0;case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))).apply(this,arguments)}e.length&&function(){t.apply(this,arguments)}()}),[e]),Object(h.jsxs)("div",{className:"nearby_bus_page",children:[Object(h.jsxs)("div",{className:"top_nav",children:[Object(h.jsx)(d,{}),Object(h.jsx)("span",{className:"nearby",children:"\u6211\u7684\u9644\u8fd1"})]}),e.length?Object(h.jsx)($,{nearbyStations:i,userLocation:e}):Object(h.jsx)("div",{className:"routes",children:Object(h.jsx)("p",{className:"no_routes",children:"\u5b9a\u4f4d\u4e2d..."})})]})}var H=n(10);function J(t){var e=t.possibleRouteInfo,n=e.routeName,a=e.routeUID,c=e.destinationName,s=e.city;return Object(h.jsxs)(r.b,{to:"/taiwan-bus/".concat(s,"/").concat(a),className:"route",children:[Object(h.jsx)("span",{className:"route_name",children:n}),Object(h.jsxs)("span",{className:"route_fromTo",children:[Object(h.jsx)("span",{children:"\u5f80\xa0"}),c]})]})}function F(t){var e=t.possibleRoutes.map((function(t){return Object(h.jsx)(J,{possibleRouteInfo:t},t.routeUID)}));return Object(h.jsx)("div",{className:"routes",children:Object(h.jsx)("div",{className:"routes_list",children:e.length?e:null})})}function P(t){var e=Object(U.g)().StationName,n=Object(U.e)().state,c=void 0===n?{}:n,s=Object(a.useState)([]),i=Object(o.a)(s,2),r=i[0],u=i[1];return Object(a.useEffect)((function(){function t(){return(t=Object(v.a)(y.a.mark((function t(){var e,n,a;return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e="https://ptx.transportdata.tw/MOTC/v2/Bus/Route/NearBy?$spatialFilter=nearby(".concat(c.userLocation[0],",").concat(c.userLocation[1],",500)&$format=JSON"),t.next=3,I(e);case 3:n=t.sent,a=c.possibleRoutes.map((function(t){var e=n.find((function(e){return e.RouteUID===t.routeUID})),a=e.DestinationStopNameZh,c=void 0===a?"":a,s=e.City,i=void 0===s?"":s;return Object(H.a)(Object(H.a)({},t),{},{destinationName:c,city:i})})).filter((function(t,e,n){return e===n.findIndex((function(e){return t.routeUID===e.routeUID}))})),u(a);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[]),Object(h.jsxs)("div",{className:"nearby_bus_page",children:[Object(h.jsxs)("div",{className:"top_nav",children:[Object(h.jsx)(k,{}),Object(h.jsx)(d,{}),Object(h.jsx)("span",{className:"nearby",children:e})]}),Object(h.jsx)(F,{possibleRoutes:r})]})}n(27);var K=function(){var t=Object(a.useState)([]),e=Object(o.a)(t,2),n=e[0],c=e[1];return Object(h.jsx)("div",{className:"App",children:Object(h.jsxs)(U.c,{children:[Object(h.jsx)(U.a,{path:"/taiwan-bus",element:Object(h.jsx)(O,{})}),Object(h.jsx)(U.a,{path:"/taiwan-bus/nearby-bus",element:Object(h.jsx)(A,{userLocation:n,setUserLocation:c})}),Object(h.jsx)(U.a,{path:"/taiwan-bus/nearby-bus/:StationName",element:Object(h.jsx)(P,{})}),Object(h.jsx)(U.a,{path:"/taiwan-bus/nearby-bus/:station/:city/:RouteUID",element:Object(h.jsx)(M,{})}),Object(h.jsx)(U.a,{path:"/taiwan-bus/search-bus",element:Object(h.jsx)(R,{})}),Object(h.jsx)(U.a,{path:"/taiwan-bus/search-bus/:city/:RouteUID",element:Object(h.jsx)(M,{})}),Object(h.jsx)(U.a,{path:"/taiwan-bus/search-train",element:Object(h.jsx)(O,{})})]})})};i.a.render(Object(h.jsx)(c.a.StrictMode,{children:Object(h.jsx)(r.a,{children:Object(h.jsx)(K,{})})}),document.getElementById("root"))}],[[28,1,2]]]);
//# sourceMappingURL=main.8ab245e3.chunk.js.map